# 图片上传模块迁移说明

## 迁移概述

图片上传模块已从 `src/common` 迁移到 `src/modules/upload`，符合 NestJS 的模块化架构设计原则。

## 目录结构变化

### 迁移前
```
src/common/
├── entities/image.entity.ts
├── dto/
│   ├── upload-image.dto.ts
│   └── upload-image-response.dto.ts
├── services/upload-image.service.ts
├── controllers/upload-image.controller.ts
└── modules/upload-image.module.ts
```

### 迁移后
```
src/modules/upload/
├── entities/image.entity.ts
├── dto/
│   ├── upload-image.dto.ts
│   └── upload-image-response.dto.ts
├── services/upload-image.service.ts
├── controllers/upload-image.controller.ts
├── docs/upload-api.md
└── upload.module.ts
```

## 主要变化

### 1. 模块名称变化
- `UploadImageModule` → `UploadModule`
- 更简洁的命名，符合模块化设计

### 2. 导入路径变化
```typescript
// 迁移前
import { UploadImageModule } from '../../common/modules/upload-image.module';
import { UploadImageService } from '../../common/services/upload-image.service';

// 迁移后
import { UploadModule } from '../upload/upload.module';
import { UploadImageService } from '../upload/services/upload-image.service';
```

### 3. 已更新的文件
- `src/app.module.ts` - 更新模块导入
- `src/modules/material/material.module.ts` - 更新模块依赖
- `src/modules/material/services/material-image-adapter.service.ts` - 更新服务导入

### 4. 文档完善
- 新增 `src/modules/upload/docs/upload-api.md` - 完整的 API 文档
- 更新 `docs/通用图片上传模块使用说明.md` - 反映新的目录结构

## 优势

### 1. 更好的模块化组织
- 图片上传作为独立的业务模块存在
- 符合 NestJS 的模块化最佳实践
- 便于功能扩展和维护

### 2. 清晰的职责划分
- `src/common` 专注于通用工具、装饰器、管道等
- `src/modules` 包含所有业务模块
- 目录结构更加清晰

### 3. 更好的可发现性
- 开发者可以在 `modules` 目录下轻松找到所有业务模块
- 图片上传功能有独立的文档和示例

## 兼容性

### 向后兼容
- 材料模块的现有接口保持不变
- 通过 `MaterialImageAdapterService` 保证兼容性
- 前端代码无需修改

### API 接口
- 通用图片上传接口: `/api/v1/upload/*`
- 材料模块适配器接口: `/upload/*` (保持不变)

## 使用方式

### 对于新业务模块
```typescript
// 1. 导入模块
import { UploadModule } from '../upload/upload.module';

@Module({
  imports: [UploadModule],
  // ...
})
export class NewBusinessModule {}

// 2. 使用服务
import { UploadImageService } from '../upload/services/upload-image.service';
import { BusinessType } from '../upload/dto/upload-image.dto';

@Injectable()
export class NewBusinessService {
  constructor(private uploadImageService: UploadImageService) {}
  
  async uploadProductImage(file: Express.Multer.File, productId: string) {
    return this.uploadImageService.uploadImage(file, {
      businessId: productId,
      businessType: BusinessType.PRODUCT,
      // ...
    }, userId);
  }
}
```

### 对于现有材料模块
- 无需修改，继续使用原有接口
- 内部自动适配到新的通用服务

## 注意事项

1. **删除了旧文件**: `src/common` 下的图片上传相关文件已被删除
2. **模块名称**: 使用 `UploadModule` 而不是 `UploadImageModule`
3. **导入路径**: 新的相对路径基于 `modules` 目录结构
4. **文档位置**: API 文档现在位于模块内部 `docs` 目录

## 总结

此次迁移使图片上传功能更好地融入了 NestJS 的模块化架构，提高了代码的组织性和可维护性，同时保持了向后兼容性。开发者现在可以更容易地发现、使用和扩展图片上传功能。