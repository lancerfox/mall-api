# 前端开发任务文档: 图片管理模块

---

## 1. 概述

本文档基于《产品需求文档 (PRD): 图片管理功能》及对应的《后端开发任务文档: 图片管理模块》进行编写，旨在为图片管理模块的前端开发提供清晰、准确的技术指引。

- **模块功能**: 实现一个标准化的图片选择器组件，并集成到商品管理页面，提供图片库浏览、图片上传、以及商品已选图片的排序、设置主图等功能。

---

## 2. 接口约定

**核心原则**: 本文档涉及的所有接口定义，包括接口地址、请求体、响应体和字段校验规则，均严格遵循《后端开发任务文档: 图片管理模块》的定义。为方便开发，相关接口的核心信息已从后端文档完整复制至此。

---

## 3. 页面与组件功能详述

### 3.1. 图片选择器 (ImageSelector) - 核心组件

这是一个独立的、可复用的弹窗组件，在商品编辑页等需要选择图片的场景下被调用。

- **功能描述**:
  - 以弹窗形式展示。
  - 包含“从图库选择”和“上传新图片”两个功能区。
  - 支持从图库多选图片。
  - 支持本地图片上传，并能感知上传进度。
  - 用户确认选择后，通过事件 (`@confirm`) 将选中的图片 ID 列表返回给父组件。

#### 3.1.1. “从图库选择” 标签页

- **功能描述**: 分页展示图片库中的所有图片，并支持用户勾选。
- **界面布局**:
  - 图片以网格形式展示。
  - 图片卡片上有关闭按钮和勾选框。
  - 底部有分页组件。
- **交互逻辑**:
  - 组件加载时，自动调用接口获取第一页数据。
  - 点击分页，加载对应页码的数据。
  - 列表加载时，显示 Loading 状态。若列表为空，显示空状态提示。
  - 点击图片卡片可进行勾选/取消勾选，选中的图片有高亮状态。
  - 弹窗顶部或底部应实时显示已选中的图片数量。
- **涉及接口**:
  - **获取图片库列表**: `POST /image/list`
    - **请求体**:
      ```json
      {
        "page": 1,
        "pageSize": 20
      }
      ```
    - **响应体**:
      ```json
      {
        "code": 200,
        "message": "查询成功",
        "data": {
          "data": [
            { "id": 2, "url": "...", "name": "..." }
          ],
          "total": 100,
          "page": 1,
          "pageSize": 20,
          "totalPages": 5
        }
      }
      ```

#### 3.1.2. “上传新图片” 标签页

- **功能描述**: 提供文件上传功能，支持拖拽和点击选择，并能实时显示上传进度。
- **界面布局**:
  - 一个拖拽区域。
  - 一个文件上传进度列表，展示每个文件的文件名、大小、进度条和状态（等待上传、上传中、成功、失败）。
- **交互逻辑**:
  1.  用户选择或拖拽文件后，前端立即进行格式和大小校验（`JPEG, PNG, GIF`, `不超过 5MB`）。
  2.  校验通过后，为每个文件调用 `POST /image/getUploadToken` 接口获取上传凭证。
  3.  获取到 `signedUrl` 后，立即使用 `PUT` 或 `POST` 请求将文件二进制内容直传到 Supabase。
  4.  监听上传进度事件，并实时更新界面上的进度条。
  5.  上传成功后，调用 `POST /image/create` 接口通知后端入库。
  6.  所有文件上传成功后，自动切换到“从图库选择”标签页，并且新上传的图片默认处于选中状态。
- **涉及接口**:
  - **获取图片上传凭证**: `POST /image/getUploadToken`
    - **请求体**:
      ```json
      {
        "fileName": "product-image-01.png",
        "fileType": "image/png"
      }
      ```
  - **创建图片记录 (入库)**: `POST /image/create`
    - **请求体**:
      ```json
      {
        "url": "https://...",
        "path": "...",
        "name": "...",
        "size": 102400
      }
      ```

### 3.2. 商品已选图片管理 (ProductImageView)

这是嵌入在商品编辑页的一个区域，用于管理已与当前商品关联的图片。

- **组件文件路径**: `views/Product/components/ProductImageView.vue` (示例)
- **功能描述**:
  - 以可拖拽的列表或网格形式，展示当前商品已选择的图片。
  - 支持通过拖拽调整图片顺序。
  - 支持将某张图片设置为“主图”。
  - 支持从商品中“移除”某张图片。
- **交互逻辑**:
  - **数据驱动**: 该组件接收一个包含图片对象的数组作为 `prop`，例如 `v-model="productImages"`。
  - **拖拽排序**: 使用 `vuedraggable` 或类似库实现。每次拖拽结束，更新 `prop` 数组的顺序。
  - **设为主图**: 点击“设为主图”按钮，修改 `prop` 数组中对应项的 `isMain` 属性为 `true`，并确保其他项的 `isMain` 为 `false`。
  - **移除**: 点击“移除”按钮，从 `prop` 数组中删除该项。
  - **数据同步**: 当用户在商品编辑页点击“保存”时，父组件将 `productImages` 数组（已包含最新的顺序和主图信息）格式化后，调用后端接口进行统一提交。
- **涉及接口**:
  - **更新商品图片关联**: `POST /product/updateImages`
    - **请求体 (由父组件在保存时调用)**:
      ```json
      {
        "productId": 101,
        "images": [
          { "imageId": 3, "isMain": true },
          { "imageId": 5, "isMain": false },
          { "imageId": 2, "isMain": false }
        ]
      }