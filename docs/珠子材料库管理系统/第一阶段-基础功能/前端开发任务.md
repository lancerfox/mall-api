# 第一阶段 - 前端开发任务

## 任务概述

基于Vue 3 + Element Plus + TypeScript技术栈，实现珠子材料库管理系统的前端基础功能，包括分类管理、材料管理的完整CRUD操作界面。

## 技术栈说明

- **框架**: Vue 3.4.15 + Composition API
- **UI组件库**: Element Plus 2.5.5
- **开发语言**: TypeScript 5.3.3
- **构建工具**: Vite 5.0.12
- **状态管理**: Pinia 2.1.7
- **路由管理**: Vue Router 4.2.5
- **HTTP请求**: Axios 1.6.7
- **样式方案**: UnoCSS + Less

## 项目结构规划

```
admin-mall/src/
├── views/bead-material/                  # 珠子材料模块
│   ├── categories/                       # 分类管理
│   │   ├── index.vue                    # 分类列表页面
│   │   └── components/                  # 分类相关组件
│   │       ├── CategoryForm.vue         # 分类表单组件
│   │       ├── CategoryTree.vue         # 分类树组件
│   │       └── CategoryDialog.vue       # 分类弹窗组件
│   └── materials/                       # 材料管理
│       ├── index.vue                    # 材料列表页面
│       ├── detail.vue                   # 材料详情页面
│       └── components/                  # 材料相关组件
│           ├── MaterialForm.vue         # 材料表单组件
│           ├── MaterialTable.vue        # 材料表格组件
│           ├── MaterialSearch.vue       # 材料搜索组件
│           ├── MaterialDialog.vue       # 材料弹窗组件
│           └── ImageUpload.vue          # 图片上传组件
├── api/bead-material/                   # API接口
│   ├── categories.ts                    # 分类接口
│   ├── materials.ts                     # 材料接口
│   └── types.ts                         # 类型定义
├── stores/modules/
│   └── beadMaterial.ts                  # 珠子材料状态管理
└── router/modules/
    └── beadMaterial.ts                  # 路由配置
```

## 详细开发任务

### 任务1: 创建API接口层 (预估时间: 3小时)

#### 1.1 类型定义文件
**文件**: `src/api/bead-material/types.ts`

**需要定义的类型**:
- `BeadCategory` - 分类数据结构
- `BeadMaterial` - 材料数据结构  
- `CreateCategoryParams` - 创建分类参数
- `UpdateCategoryParams` - 更新分类参数
- `QueryCategoryParams` - 查询分类参数
- `CreateMaterialParams` - 创建材料参数
- `UpdateMaterialParams` - 更新材料参数
- `QueryMaterialParams` - 查询材料参数
- `BatchOperationParams` - 批量操作参数
- `ApiResponse` - API响应格式
- `PaginationResponse` - 分页响应格式

**分类字段结构**:
```typescript
BeadCategory {
  _id: string
  name: string
  parent_id: string | null
  description?: string
  sort_order: number
  material_count: number
  is_active: boolean
  created_at: string
  updated_at: string
  children?: BeadCategory[]
}
```

**材料字段结构**:
```typescript
BeadMaterial {
  _id: string
  name: string
  category_id: string
  category_name?: string
  image_url?: string
  size: number
  price: number
  stock_quantity: number
  min_stock_level: number
  stock_status: 'normal' | 'low' | 'out'
  description?: string
  properties: Record<string, any>
  is_active: boolean
  created_at: string
  updated_at: string
}
```

#### 1.2 分类API接口文件
**文件**: `src/api/bead-material/categories.ts`

**需要实现的接口**:
- `getCategoriesApi()` - 获取分类列表
- `createCategoryApi()` - 创建分类
- `updateCategoryApi()` - 更新分类
- `deleteCategoryApi()` - 删除分类
- `getCategoryTreeApi()` - 获取分类树

**使用的后端接口**:
- `GET /categories`
- `POST /categories`
- `POST /categories/:id`
- `POST /categories/:id`

#### 1.3 材料API接口文件
**文件**: `src/api/bead-material/materials.ts`

**需要实现的接口**:
- `getMaterialsApi()` - 获取材料列表
- `createMaterialApi()` - 创建材料
- `getMaterialDetailApi()` - 获取材料详情
- `updateMaterialApi()` - 更新材料
- `deleteMaterialApi()` - 删除材料
- `batchOperationMaterialsApi()` - 批量操作材料
- `searchMaterialsApi()` - 搜索材料

**使用的后端接口**:
- `GET /materials`
- `POST /materials`
- `GET /materials/:id`
- `POST /materials/:id`
- `POST /materials/:id`
- `POST /materials/batch`
- `GET /materials/search`

### 任务2: 创建状态管理 (预估时间: 2小时)

#### 2.1 Pinia Store
**文件**: `src/stores/modules/beadMaterial.ts`

**状态管理内容**:
- 分类列表数据缓存
- 分类树数据缓存
- 材料列表数据缓存
- 当前材料详情数据
- 加载状态管理
- 分页信息管理

**需要实现的方法**:
- `fetchCategories()` - 获取分类列表
- `fetchCategoryTree()` - 获取分类树
- `createCategory()` - 创建分类
- `updateCategory()` - 更新分类
- `deleteCategory()` - 删除分类
- `fetchMaterials()` - 获取材料列表
- `fetchMaterialDetail()` - 获取材料详情
- `createMaterial()` - 创建材料
- `updateMaterial()` - 更新材料
- `deleteMaterial()` - 删除材料
- `batchOperationMaterials()` - 批量操作材料

**计算属性**:
- `activeCategoriesTree` - 启用状态的分类树
- `categoryOptions` - 分类选项列表（用于下拉选择）

### 任务3: 创建路由配置 (预估时间: 1小时)

#### 3.1 路由模块
**文件**: `src/router/modules/beadMaterial.ts`

**路由结构**:
- `/bead-material` - 珠子材料库主路由
  - `/bead-material/categories` - 分类管理页面
  - `/bead-material/materials` - 材料管理页面
  - `/bead-material/materials/detail/:id` - 材料详情页面

**路由元信息**:
- 页面标题设置
- 图标配置
- 权限控制
- 面包屑导航

### 任务4: 创建分类管理页面 (预估时间: 6小时)

#### 4.1 分类列表主页面
**文件**: `src/views/bead-material/categories/index.vue`

**页面功能**:
- 分类树形表格展示
- 新增顶级分类
- 编辑分类信息
- 添加子分类
- 删除分类（带确认）
- 刷新数据

**表格字段**:
- 分类名称（支持树形展示）
- 分类描述
- 材料数量（标签显示）
- 排序顺序
- 启用状态（标签显示）
- 创建时间
- 操作按钮（编辑、添加子分类、删除）

**使用的接口**:
- 获取分类列表
- 删除分类

#### 4.2 分类表单弹窗组件
**文件**: `src/views/bead-material/categories/components/CategoryDialog.vue`

**组件功能**:
- 新增/编辑分类表单
- 表单验证
- 父级分类选择（下拉树形选择）
- 提交处理

**表单字段及验证规则**:

| 字段 | 类型 | 必填 | 验证规则 | Element Plus验证规则 |
|------|------|------|----------|---------------------|
| name | String | 是 | 长度1-100字符，支持中文、英文、数字、空格、连字符、下划线、括号 | `[{ required: true, message: '请输入分类名称', trigger: 'blur' }, { min: 1, max: 100, message: '分类名称长度在1到100个字符', trigger: 'blur' }, { pattern: /^[\u4e00-\u9fa5a-zA-Z0-9\s\-_()（）]+$/, message: '分类名称格式不正确', trigger: 'blur' }]` |
| parent_id | String | 否 | 有效的ObjectId或空 | `[{ validator: validateObjectId, trigger: 'change' }]` |
| description | String | 否 | 最大500字符 | `[{ max: 500, message: '描述长度不能超过500个字符', trigger: 'blur' }]` |
| sort_order | Number | 否 | 0-9999的整数 | `[{ type: 'number', min: 0, max: 9999, message: '排序顺序必须在0-9999之间', trigger: 'blur' }]` |

**自定义验证函数**:
```typescript
// ObjectId格式验证
const validateObjectId = (rule: any, value: any, callback: any) => {
  if (value && !/^[0-9a-fA-F]{24}$/.test(value)) {
    callback(new Error('ID格式不正确'));
  } else {
    callback();
  }
};
```

**使用的接口**:
- 创建分类
- 更新分类
- 获取分类树（用于父级选择）

#### 4.3 分类树组件
**文件**: `src/views/bead-material/categories/components/CategoryTree.vue`

**组件功能**:
- 树形结构展示分类
- 支持展开/收起
- 节点选择功能
- 拖拽排序（可选）

### 任务5: 创建材料管理页面 (预估时间: 8小时)

#### 5.1 材料列表主页面
**文件**: `src/views/bead-material/materials/index.vue`

**页面功能**:
- 材料列表表格展示
- 高级搜索功能
- 批量操作（删除、启用、禁用）
- 新增材料
- 编辑材料
- 查看材料详情
- 分页导航

**搜索条件及验证**:

| 字段 | 类型 | 验证规则 | Element Plus验证规则 |
|------|------|----------|---------------------|
| keyword | String | 最大200字符 | `[{ max: 200, message: '关键词不能超过200个字符', trigger: 'blur' }]` |
| category_id | String | 有效的ObjectId | `[{ validator: validateObjectId, trigger: 'change' }]` |
| min_price | Number | 非负数字 | `[{ type: 'number', min: 0, message: '最低价格不能小于0', trigger: 'blur' }]` |
| max_price | Number | 非负数字，且≥min_price | `[{ type: 'number', min: 0, message: '最高价格不能小于0', trigger: 'blur' }, { validator: validatePriceRange, trigger: 'blur' }]` |
| stock_status | String | 枚举值：normal/low/out | `[{ validator: validateStockStatus, trigger: 'change' }]` |

**表格字段**:
- 材料图片（缩略图）
- 材料名称
- 所属分类
- 尺寸规格
- 单价
- 库存数量
- 库存状态（标签显示）
- 启用状态
- 创建时间
- 操作按钮

**使用的接口**:
- 获取材料列表
- 搜索材料
- 批量操作材料
- 删除材料

#### 5.2 材料搜索组件
**文件**: `src/views/bead-material/materials/components/MaterialSearch.vue`

**组件功能**:
- 关键词输入框
- 分类选择器
- 价格范围输入
- 库存状态选择
- 启用状态选择
- 排序方式选择
- 搜索/重置按钮

#### 5.3 材料表单弹窗组件
**文件**: `src/views/bead-material/materials/components/MaterialDialog.vue`

**组件功能**:
- 新增/编辑材料表单
- 图片上传功能
- 表单验证
- 材料属性动态配置

**表单字段及验证规则**:

| 字段 | 类型 | 必填 | 验证规则 | Element Plus验证规则 |
|------|------|------|----------|---------------------|
| name | String | 是 | 长度1-100字符，支持中文、英文、数字、空格、连字符、下划线、括号、点号 | `[{ required: true, message: '请输入材料名称', trigger: 'blur' }, { min: 1, max: 100, message: '材料名称长度在1到100个字符', trigger: 'blur' }, { pattern: /^[\u4e00-\u9fa5a-zA-Z0-9\s\-_()（）.·]+$/, message: '材料名称格式不正确', trigger: 'blur' }]` |
| category_id | String | 是 | 有效的ObjectId | `[{ required: true, message: '请选择材料分类', trigger: 'change' }, { validator: validateObjectId, trigger: 'change' }]` |
| image_url | String | 否 | 有效的URL，最大500字符，支持jpg/png/gif/webp | `[{ max: 500, message: 'URL长度不能超过500个字符', trigger: 'blur' }, { type: 'url', message: '请输入正确的URL格式', trigger: 'blur' }, { pattern: /\.(jpg|jpeg|png|gif|webp)$/i, message: '仅支持jpg、png、gif、webp格式', trigger: 'blur' }]` |
| size | Number | 否 | 0.1-1000的数字 | `[{ type: 'number', min: 0.1, max: 1000, message: '尺寸必须在0.1-1000mm之间', trigger: 'blur' }]` |
| price | Number | 否 | 0-999999.99的数字 | `[{ type: 'number', min: 0, max: 999999.99, message: '价格必须在0-999999.99之间', trigger: 'blur' }]` |
| stock_quantity | Number | 否 | 非负整数 | `[{ type: 'integer', min: 0, message: '库存数量必须是非负整数', trigger: 'blur' }]` |
| min_stock_level | Number | 否 | 非负整数 | `[{ type: 'integer', min: 0, message: '最低库存预警值必须是非负整数', trigger: 'blur' }]` |
| description | String | 否 | 最大1000字符 | `[{ max: 1000, message: '描述长度不能超过1000个字符', trigger: 'blur' }]` |

**材料属性字段验证**:

| 属性字段 | 类型 | 验证规则 | Element Plus验证规则 |
|----------|------|----------|---------------------|
| properties.color | String | 最大50字符 | `[{ max: 50, message: '颜色名称不能超过50个字符', trigger: 'blur' }]` |
| properties.hardness | Number | 1-10的数字 | `[{ type: 'number', min: 1, max: 10, message: '硬度必须在1-10之间', trigger: 'blur' }]` |
| properties.density | Number | 0.1-50的数字 | `[{ type: 'number', min: 0.1, max: 50, message: '密度必须在0.1-50之间', trigger: 'blur' }]` |
| properties.transparency | String | 枚举值：透明/半透明/不透明 | `[{ validator: validateTransparency, trigger: 'change' }]` |
| properties.origin | String | 最大100字符 | `[{ max: 100, message: '产地名称不能超过100个字符', trigger: 'blur' }]` |

**自定义验证函数**:
```typescript
// 价格范围验证
const validatePriceRange = (rule: any, value: any, callback: any) => {
  const minPrice = formData.min_price;
  if (minPrice && value && value < minPrice) {
    callback(new Error('最高价格必须大于等于最低价格'));
  } else {
    callback();
  }
};

// 库存状态验证
const validateStockStatus = (rule: any, value: any, callback: any) => {
  const validStatus = ['normal', 'low', 'out'];
  if (value && !validStatus.includes(value)) {
    callback(new Error('库存状态值不正确'));
  } else {
    callback();
  }
};

// 透明度验证
const validateTransparency = (rule: any, value: any, callback: any) => {
  const validValues = ['透明', '半透明', '不透明'];
  if (value && !validValues.includes(value)) {
    callback(new Error('透明度值不正确'));
  } else {
    callback();
  }
};
```

**使用的接口**:
- 创建材料
- 更新材料
- 获取分类选项

#### 5.4 图片上传组件
**文件**: `src/views/bead-material/materials/components/ImageUpload.vue`

**组件功能**:
- 图片文件选择
- 图片预览
- 上传进度显示
- 图片裁剪（可选）
- 删除图片

#### 5.5 材料详情页面
**文件**: `src/views/bead-material/materials/detail.vue`

**页面功能**:
- 材料基本信息展示
- 材料图片展示
- 材料属性展示
- 库存信息展示
- 编辑按钮
- 返回列表按钮

**使用的接口**:
- 获取材料详情

### 任务6: 创建公共组件 (预估时间: 3小时)

#### 6.1 通用搜索表单组件
**文件**: `src/components/BeadMaterial/SearchForm.vue`

**组件功能**:
- 可配置的搜索字段
- 统一的搜索样式
- 搜索条件重置

#### 6.2 批量操作组件
**文件**: `src/components/BeadMaterial/BatchActions.vue`

**组件功能**:
- 全选/反选功能
- 批量操作按钮组
- 操作确认提示

#### 6.3 状态标签组件
**文件**: `src/components/BeadMaterial/StatusTag.vue`

**组件功能**:
- 库存状态标签显示
- 启用状态标签显示
- 统一的状态颜色规范

### 任务7: 样式和主题 (预估时间: 2小时)

#### 7.1 模块样式文件
**文件**: `src/views/bead-material/styles/index.less`

**样式内容**:
- 页面布局样式
- 表格自定义样式
- 表单样式优化
- 响应式适配

#### 7.2 组件样式规范
- 统一的间距规范
- 颜色主题适配
- 字体大小规范
- 交互状态样式

## Mock数据字段

### 分类Mock数据
```json
{
  "_id": "507f1f77bcf86cd799439011",
  "name": "水晶类",
  "parent_id": null,
  "description": "各类水晶材料",
  "sort_order": 1,
  "material_count": 25,
  "is_active": true,
  "created_at": "2024-01-01T10:00:00.000Z",
  "updated_at": "2024-01-01T10:00:00.000Z"
}
```

### 材料Mock数据
```json
{
  "_id": "507f1f77bcf86cd799439012",
  "name": "白水晶",
  "category_id": "507f1f77bcf86cd799439011",
  "category_name": "水晶类",
  "image_url": "https://example.com/images/white-crystal.jpg",
  "size": 12.0,
  "price": 15.5,
  "stock_quantity": 100,
  "min_stock_level": 10,
  "stock_status": "normal",
  "description": "纯净的白水晶珠子，质地坚硬，透明度高",
  "properties": {
    "color": "白色",
    "hardness": 7,
    "density": 2.65,
    "transparency": "透明",
    "origin": "巴西"
  },
  "is_active": true,
  "created_at": "2024-01-01T10:00:00.000Z",
  "updated_at": "2024-01-01T10:00:00.000Z"
}
```

### 搜索参数Mock数据
```json
{
  "keyword": "水晶",
  "category_id": "507f1f77bcf86cd799439011",
  "min_price": 10.0,
  "max_price": 100.0,
  "stock_status": "normal",
  "is_active": true,
  "sort_by": "created_at",
  "sort_order": "desc",
  "page": 1,
  "page_size": 20
}
```

### 批量操作Mock数据
```json
{
  "action": "enable",
  "ids": [
    "507f1f77bcf86cd799439012",
    "507f1f77bcf86cd799439013",
    "507f1f77bcf86cd799439014"
  ]
}
```

## 验收标准

### 功能验收
1. ✅ 分类管理CRUD操作完整
2. ✅ 材料管理CRUD操作完整
3. ✅ 搜索和筛选功能正常
4. ✅ 批量操作功能正常
5. ✅ 图片上传功能正常
6. ✅ 分页功能正常
7. ✅ 表单验证完整

### 界面验收
1. ✅ 界面布局合理美观
2. ✅ 响应式适配良好
3. ✅ 交互体验流畅
4. ✅ 加载状态提示完整
5. ✅ 错误提示友好

### 代码质量验收
1. ✅ TypeScript类型定义完整
2. ✅ 组件结构清晰
3. ✅ 代码复用性良好
4. ✅ ESLint检查通过
5. ✅ 性能优化合理

## 预估总时间

**总计：25小时**

- API接口层：3小时
- 状态管理：2小时
- 路由配置：1小时
- 分类管理页面：6小时
- 材料管理页面：8小时
- 公共组件：3小时
- 样式和主题：2小时

## 开发注意事项

1. **数据格式统一**: 确保前后端数据格式一致
2. **错误处理**: 完善的错误提示和异常处理
3. **性能优化**: 合理使用缓存和懒加载
4. **用户体验**: 加载状态、操作反馈要及时
5. **代码规范**: 遵循项目既定的代码规范
6. **类型安全**: 充分利用TypeScript的类型检查
7. **组件复用**: 提取公共组件，避免重复代码