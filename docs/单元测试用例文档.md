# å•å…ƒæµ‹è¯•ç”¨ä¾‹æ–‡æ¡£

## é‡è¦è¯´æ˜

**æ¥å£å“åº”è§„èŒƒ**: åªè¦æ¥å£èƒ½æ­£ç¡®è°ƒç”¨ï¼ŒHTTPçŠ¶æ€ç éƒ½æ˜¯200ã€‚ä¸šåŠ¡å¤„ç†é”™è¯¯ä¸»è¦é€šè¿‡ä¸šåŠ¡ç codeæ¥åé¦ˆï¼Œè€Œä¸æ˜¯ä½¿ç”¨HTTPçŠ¶æ€ç ï¼ˆå¦‚400ã€401ã€404ç­‰ï¼‰ã€‚

## æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°äº† mall-api é¡¹ç›®çš„å•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼ŒåŸºäºç°æœ‰çš„æ¥å£åŠŸèƒ½å’ŒçŠ¶æ€ç è®¾è®¡ã€‚æµ‹è¯•ä½¿ç”¨ Jest æ¡†æ¶ï¼Œæ–­è¨€ä½¿ç”¨ä¸­æ–‡æè¿°ï¼Œæµ‹è¯•æ•°æ®ä½¿ç”¨æœ¬åœ° MongoDB æœåŠ¡ã€‚

## æµ‹è¯•ç¯å¢ƒé…ç½®

### æµ‹è¯•æ¡†æ¶å’Œå·¥å…·
- **æµ‹è¯•æ¡†æ¶**: Jest 30.0.0
- **æ–­è¨€åº“**: Jestå†…ç½®æ–­è¨€ï¼Œæ”¯æŒä¸­æ–‡æè¿°
- **æµ‹è¯•è¿è¡Œå™¨**: Jest CLI
- **æ•°æ®åº“**: MongoDB æœ¬åœ°æœåŠ¡ (mall-api-testæ•°æ®åº“)
- **æµ‹è¯•ç±»å‹**: å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•

### ç¯å¢ƒè¦æ±‚
- Node.js 18+
- MongoDB 6.0+ æœ¬åœ°è¿è¡Œ
- npm æˆ– yarn åŒ…ç®¡ç†å™¨

### é…ç½®æ–‡ä»¶
é¡¹ç›®å·²é…ç½®ä»¥ä¸‹æµ‹è¯•é…ç½®æ–‡ä»¶ï¼š
- `package.json` - JeståŸºç¡€é…ç½®
- `test/jest-e2e.json` - ç«¯åˆ°ç«¯æµ‹è¯•é…ç½®
- `.env.test` - æµ‹è¯•ç¯å¢ƒå˜é‡ï¼ˆéœ€è¦åˆ›å»ºï¼‰

## æµ‹è¯•æ–‡ä»¶ç»“æ„

```
test/
â”œâ”€â”€ setup/                    # æµ‹è¯•è®¾ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ database.setup.ts    # æ•°æ®åº“è¿æ¥é…ç½®
â”‚   â”œâ”€â”€ fixtures/           # æµ‹è¯•æ•°æ®å¤¹å…·
â”‚   â”‚   â”œâ”€â”€ users.fixture.ts
â”‚   â”‚   â”œâ”€â”€ roles.fixture.ts
â”‚   â”‚   â”œâ”€â”€ permissions.fixture.ts
â”‚   â”‚   â”œâ”€â”€ menus.fixture.ts
â”‚   â”‚   â”œâ”€â”€ materials.fixture.ts
â”‚   â”‚   â””â”€â”€ categories.fixture.ts
â”‚   â””â”€â”€ mocks/              # æ¨¡æ‹Ÿå¯¹è±¡
â”‚       â”œâ”€â”€ auth.mock.ts
â”‚       â”œâ”€â”€ database.mock.ts
â”‚       â””â”€â”€ external-services.mock.ts
â”œâ”€â”€ modules/                # æ¨¡å—æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ auth/              # è®¤è¯æ¨¡å—æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ auth.controller.spec.ts
â”‚   â”‚   â”œâ”€â”€ auth.service.spec.ts
â”‚   â”‚   â””â”€â”€ auth.guard.spec.ts
â”‚   â”œâ”€â”€ user/              # ç”¨æˆ·ç®¡ç†æ¨¡å—æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ user.controller.spec.ts
â”‚   â”‚   â”œâ”€â”€ user.service.spec.ts
â”‚   â”‚   â””â”€â”€ user.repository.spec.ts
â”‚   â”œâ”€â”€ role/              # è§’è‰²ç®¡ç†æ¨¡å—æµ‹è¯•
â”‚   â”œâ”€â”€ permission/        # æƒé™ç®¡ç†æ¨¡å—æµ‹è¯•
â”‚   â”œâ”€â”€ menu/              # èœå•ç®¡ç†æ¨¡å—æµ‹è¯•
â”‚   â”œâ”€â”€ material/          # ææ–™ç®¡ç†æ¨¡å—æµ‹è¯•
â”‚   â””â”€â”€ category/          # åˆ†ç±»ç®¡ç†æ¨¡å—æµ‹è¯•
â”œâ”€â”€ common/                # é€šç”¨åŠŸèƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ pipes/
â”‚   â”œâ”€â”€ guards/
â”‚   â”œâ”€â”€ interceptors/
â”‚   â””â”€â”€ utils/
â””â”€â”€ e2e/                   # ç«¯åˆ°ç«¯æµ‹è¯•
    â”œâ”€â”€ auth.e2e-spec.ts
    â””â”€â”€ user.e2e-spec.ts
```

## æµ‹è¯•ç¯å¢ƒè®¾ç½®

### 1. ç¯å¢ƒå˜é‡é…ç½®
åˆ›å»º `.env.test` æ–‡ä»¶ç”¨äºæµ‹è¯•ç¯å¢ƒï¼š

```bash
# æ•°æ®åº“é…ç½®
DATABASE_URL=mongodb://localhost:27017/mall-api-test
DATABASE_NAME=mall-api-test

# JWTé…ç½®
JWT_SECRET=test-jwt-secret-key-for-unit-testing-only
JWT_EXPIRES_IN=1h

# åº”ç”¨é…ç½®
NODE_ENV=test
PORT=3000
LOG_LEVEL=error

# æµ‹è¯•ä¸“ç”¨é…ç½®
TEST_TIMEOUT=30000
TEST_DB_CLEANUP=true
```

### 2. æ•°æ®åº“é…ç½®è„šæœ¬
åˆ›å»º `test/setup/database.setup.ts`ï¼š

```typescript
import { connect, connection, ConnectOptions } from 'mongoose';
import { config } from 'dotenv';

// åŠ è½½æµ‹è¯•ç¯å¢ƒå˜é‡
config({ path: '.env.test' });

/**
 * è¿æ¥åˆ°æµ‹è¯•æ•°æ®åº“
 */
export const connectTestDB = async (): Promise<void> => {
  const dbUri = process.env.DATABASE_URL || 'mongodb://localhost:27017/mall-api-test';
  const options: ConnectOptions = {
    dbName: process.env.DATABASE_NAME || 'mall-api-test',
    maxPoolSize: 5,
    minPoolSize: 1,
    socketTimeoutMS: 30000,
    connectTimeoutMS: 10000,
  };

  try {
    await connect(dbUri, options);
    console.log('æµ‹è¯•æ•°æ®åº“è¿æ¥æˆåŠŸ');
  } catch (error) {
    console.error('æµ‹è¯•æ•°æ®åº“è¿æ¥å¤±è´¥:', error);
    throw error;
  }
};

/**
 * æ¸…ç©ºæµ‹è¯•æ•°æ®åº“
 */
export const clearTestDB = async (): Promise<void> => {
  const collections = connection.collections;
  
  for (const key in collections) {
    try {
      await collections[key].deleteMany({});
    } catch (error) {
      console.warn(`æ¸…ç©ºé›†åˆ ${key} æ—¶å‡ºé”™:`, error);
    }
  }
};

/**
 * æ–­å¼€æ•°æ®åº“è¿æ¥
 */
export const disconnectTestDB = async (): Promise<void> => {
  try {
    await connection.close();
    console.log('æµ‹è¯•æ•°æ®åº“è¿æ¥å·²æ–­å¼€');
  } catch (error) {
    console.error('æ–­å¼€æ•°æ®åº“è¿æ¥æ—¶å‡ºé”™:', error);
    throw error;
  }
};

/**
 * è·å–æ•°æ®åº“è¿æ¥çŠ¶æ€
 */
export const getDBConnectionState = (): number => {
  return connection.readyState;
};
```

### 3. Jestå…¨å±€è®¾ç½®
åˆ›å»º `test/setup/jest.setup.ts`ï¼š

```typescript
import { connectTestDB, clearTestDB, disconnectTestDB } from './database.setup';

// å…¨å±€æµ‹è¯•è¶…æ—¶è®¾ç½®
jest.setTimeout(30000);

// åœ¨æ‰€æœ‰æµ‹è¯•ä¹‹å‰è¿è¡Œ
beforeAll(async () => {
  console.log('æ­£åœ¨è¿æ¥æµ‹è¯•æ•°æ®åº“...');
  await connectTestDB();
});

// åœ¨æ¯ä¸ªæµ‹è¯•ä¹‹åè¿è¡Œ
afterEach(async () => {
  if (process.env.TEST_DB_CLEANUP === 'true') {
    await clearTestDB();
  }
});

// åœ¨æ‰€æœ‰æµ‹è¯•ä¹‹åè¿è¡Œ
afterAll(async () => {
  console.log('æ­£åœ¨æ–­å¼€æµ‹è¯•æ•°æ®åº“è¿æ¥...');
  await disconnectTestDB();
});
```

## æµ‹è¯•æ‰§è¡Œæµç¨‹

### 1. æµ‹è¯•ç”Ÿå‘½å‘¨æœŸ
```mermaid
graph TD
    A[å¼€å§‹æµ‹è¯•] --> B[beforeAll: è¿æ¥æ•°æ®åº“]
    B --> C[beforeEach: æ¸…ç©ºæ•°æ®åº“]
    C --> D[æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹]
    D --> E[afterEach: å¯é€‰æ¸…ç©ºæ•°æ®åº“]
    E --> F{è¿˜æœ‰æ›´å¤šæµ‹è¯•?}
    F -->|æ˜¯| C
    F -->|å¦| G[afterAll: æ–­å¼€æ•°æ®åº“è¿æ¥]
    G --> H[æµ‹è¯•å®Œæˆ]
```

### 2. æµ‹è¯•æ‰§è¡Œæ­¥éª¤
1. **ç¯å¢ƒå‡†å¤‡**: ç¡®ä¿MongoDBæœ¬åœ°æœåŠ¡è¿è¡Œï¼Œç«¯å£27017
2. **å®‰è£…ä¾èµ–**: `npm install`
3. **è®¾ç½®ç¯å¢ƒ**: å¤åˆ¶`.env.test`æ–‡ä»¶å¹¶é…ç½®æµ‹è¯•æ•°æ®åº“
4. **è¿è¡Œæµ‹è¯•**: æ‰§è¡Œç›¸åº”çš„æµ‹è¯•å‘½ä»¤
5. **æŸ¥çœ‹ç»“æœ**: æ£€æŸ¥æµ‹è¯•è¾“å‡ºå’Œè¦†ç›–ç‡æŠ¥å‘Š

### 3. æµ‹è¯•æ•°æ®å‡†å¤‡ç­–ç•¥

#### 3.1 æµ‹è¯•æ•°æ®å¤¹å…·
åˆ›å»º `test/setup/fixtures/users.fixture.ts`ï¼š

```typescript
import { Types } from 'mongoose';

export const testUsers = {
  adminUser: {
    _id: new Types.ObjectId(),
    username: 'admin',
    password: '$2b$10$ExampleHashedPassword', // bcrypt hash
    email: 'admin@example.com',
    phone: '13800138001',
    role: 'admin',
    status: 'active',
    createdAt: new Date(),
    updatedAt: new Date()
  },
  testUser: {
    _id: new Types.ObjectId(),
    username: 'testuser',
    password: '$2b$10$ExampleHashedPassword2',
    email: 'test@example.com',
    phone: '13800138000',
    role: 'user',
    status: 'active',
    createdAt: new Date(),
    updatedAt: new Date()
  },
  disabledUser: {
    _id: new Types.ObjectId(),
    username: 'disabled',
    password: '$2b$10$ExampleHashedPassword3',
    email: 'disabled@example.com',
    phone: '13800138002',
    role: 'user',
    status: 'disabled',
    createdAt: new Date(),
    updatedAt: new Date()
  }
};

export const createUserFixtures = async (userModel: any) => {
  await userModel.insertMany(Object.values(testUsers));
};
```

#### 3.2 æµ‹è¯•æ•°æ®å·¥å‚
åˆ›å»º `test/setup/factories/user.factory.ts`ï¼š

```typescript
import { faker } from '@faker-js/faker';
import { Types } from 'mongoose';

export class UserFactory {
  static create(overrides: Partial<any> = {}) {
    return {
      _id: new Types.ObjectId(),
      username: faker.internet.userName(),
      password: faker.internet.password(),
      email: faker.internet.email(),
      phone: faker.phone.number(),
      role: 'user',
      status: 'active',
      createdAt: new Date(),
      updatedAt: new Date(),
      ...overrides
    };
  }

  static createMany(count: number, overrides: Partial<any> = {}) {
    return Array.from({ length: count }, () => this.create(overrides));
  }
}
```

## æµ‹è¯•å‘½ä»¤å’Œè„šæœ¬

### 1. åŸºç¡€æµ‹è¯•å‘½ä»¤
```bash
# è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
npm test

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:cov

# ç›‘è§†æ¨¡å¼è¿è¡Œæµ‹è¯•ï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼‰
npm run test:watch

# è¿è¡Œç‰¹å®šæ¨¡å—çš„æµ‹è¯•
npm test -- --testNamePattern="è®¤è¯æ¨¡å—"

# è¿è¡ŒåŒ…å«ç‰¹å®šæè¿°çš„æµ‹è¯•
npm test -- --testNamePattern="ç”¨æˆ·ç™»å½•"

# è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
npm run test:e2e

# è°ƒè¯•æµ‹è¯•
npm run test:debug
```

### 2. æµ‹è¯•è¦†ç›–ç‡é…ç½®
åœ¨ `package.json` ä¸­å®Œå–„ Jest é…ç½®ï¼š

```json
{
  "jest": {
    "moduleFileExtensions": ["js", "json", "ts"],
    "rootDir": "src",
    "testRegex": ".*\\.spec\\.ts$",
    "transform": {
      "^.+\\.(t|j)s$": "ts-jest"
    },
    "collectCoverageFrom": [
      "**/*.(t|j)s",
      "!**/*.d.ts",
      "!**/main.ts",
      "!**/node_modules/**",
      "!**/test/**",
      "!**/dist/**"
    ],
    "coverageDirectory": "../coverage",
    "testEnvironment": "node",
    "setupFilesAfterEnv": ["<rootDir>/../test/setup/jest.setup.ts"],
    "coverageThreshold": {
      "global": {
        "branches": 70,
        "functions": 80,
        "lines": 80,
        "statements": 80
      }
    },
    "coverageReporters": ["text", "lcov", "html"],
    "testTimeout": 30000
  }
}
```

### 3. æµ‹è¯•è„šæœ¬ç¤ºä¾‹
åˆ›å»º `scripts/test-setup.js` ç”¨äºæµ‹è¯•ç¯å¢ƒå‡†å¤‡ï¼š

```javascript
#!/usr/bin/env node

const { execSync } = require('child_process');
const fs = require('fs');
const path = require('path');

// æ£€æŸ¥MongoDBæ˜¯å¦è¿è¡Œ
function checkMongoDB() {
  try {
    execSync('mongosh --eval "db.adminCommand(\'ping\')"', { 
      stdio: 'pipe',
      timeout: 5000 
    });
    console.log('âœ… MongoDB æœåŠ¡æ­£å¸¸è¿è¡Œ');
    return true;
  } catch (error) {
    console.error('âŒ MongoDB æœåŠ¡æœªè¿è¡Œæˆ–æ— æ³•è¿æ¥');
    console.log('è¯·è¿è¡Œ: brew services start mongodb-community@6.0');
    return false;
  }
}

// åˆ›å»ºæµ‹è¯•ç¯å¢ƒæ–‡ä»¶
function setupTestEnv() {
  const envExamplePath = path.join(__dirname, '..', '.env.example');
  const envTestPath = path.join(__dirname, '..', '.env.test');
  
  if (!fs.existsSync(envTestPath)) {
    if (fs.existsSync(envExamplePath)) {
      fs.copyFileSync(envExamplePath, envTestPath);
      console.log('âœ… å·²åˆ›å»º .env.test æ–‡ä»¶');
    } else {
      const testEnvContent = `
# æµ‹è¯•ç¯å¢ƒé…ç½®
DATABASE_URL=mongodb://localhost:27017/mall-api-test
JWT_SECRET=test-jwt-secret-key-for-unit-testing-only
NODE_ENV=test
PORT=3000
      `.trim();
      fs.writeFileSync(envTestPath, testEnvContent);
      console.log('âœ… å·²åˆ›å»º .env.test æ–‡ä»¶');
    }
  } else {
    console.log('âœ… .env.test æ–‡ä»¶å·²å­˜åœ¨');
  }
}

// ä¸»å‡½æ•°
function main() {
  console.log('ğŸš€ æ­£åœ¨è®¾ç½®æµ‹è¯•ç¯å¢ƒ...\n');
  
  // æ£€æŸ¥MongoDB
  if (!checkMongoDB()) {
    process.exit(1);
  }
  
  // è®¾ç½®ç¯å¢ƒæ–‡ä»¶
  setupTestEnv();
  
  console.log('\nâœ… æµ‹è¯•ç¯å¢ƒè®¾ç½®å®Œæˆï¼');
  console.log('è¿è¡Œä»¥ä¸‹å‘½ä»¤å¼€å§‹æµ‹è¯•:');
  console.log('  npm test        # è¿è¡Œæ‰€æœ‰æµ‹è¯•');
  console.log('  npm run test:cov # è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š');
}

// æ‰§è¡Œ
main();
```

### 4. æµ‹è¯•æ‰§è¡Œç¤ºä¾‹
```bash
# ç¬¬ä¸€æ¬¡è¿è¡Œæµ‹è¯•å‰çš„è®¾ç½®
chmod +x scripts/test-setup.js
node scripts/test-setup.js

# è¿è¡Œç‰¹å®šæµ‹è¯•æ¨¡å—
npm test -- --testPathPattern="src/modules/auth"

# è¿è¡Œæµ‹è¯•å¹¶è¾“å‡ºè¯¦ç»†ç»“æœ
npm test -- --verbose

# è¿è¡Œå¤±è´¥çš„æµ‹è¯•
npm test -- --onlyFailures

# ç”ŸæˆHTMLè¦†ç›–ç‡æŠ¥å‘Š
npm run test:cov && open coverage/index.html
```

## æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•å‘½åè§„èŒƒ
```typescript
// å¥½çš„å‘½å
describe('ç”¨æˆ·æœåŠ¡', () => {
  it('åº”è¯¥æˆåŠŸåˆ›å»ºç”¨æˆ·', () => {});
  it('é‡å¤ç”¨æˆ·ååº”è¯¥è¿”å›é”™è¯¯', () => {});
});

// ä¸å¥½çš„å‘½å  
describe('UserService', () => {
  it('test create user', () => {});
});
```

### 2. æ–­è¨€æœ€ä½³å®è·µ
```typescript
// ä½¿ç”¨ä¸­æ–‡æè¿°
expect(result).toEqual(expected);
// æ–­è¨€: æœŸæœ›ç»“æœç­‰äºé¢„æœŸå€¼

expect(user.status).toBe('active');
// æ–­è¨€: æœŸæœ›ç”¨æˆ·çŠ¶æ€ä¸ºæ´»è·ƒ

expect(() => service.createUser(invalidData)).toThrow(ValidationError);
// æ–­è¨€: æœŸæœ›ä½¿ç”¨æ— æ•ˆæ•°æ®åˆ›å»ºç”¨æˆ·æ—¶æŠ›å‡ºéªŒè¯é”™è¯¯

expect(console.error).toHaveBeenCalledWith('é”™è¯¯æ¶ˆæ¯');
// æ–­è¨€: æœŸæœ›æ§åˆ¶å°è¾“å‡ºé”™è¯¯æ¶ˆæ¯
```

### 3. æµ‹è¯•éš”ç¦»
- æ¯ä¸ªæµ‹è¯•åº”è¯¥ç‹¬ç«‹è¿è¡Œ
- ä½¿ç”¨ beforeEach/afterEach æ¸…ç†çŠ¶æ€
- é¿å…æµ‹è¯•ä¹‹é—´çš„ä¾èµ–å…³ç³»

### 4. æ€§èƒ½è€ƒè™‘
- æµ‹è¯•è¿è¡Œæ—¶é—´åº”è¯¥åˆç†
- ä½¿ç”¨ mock æ›¿ä»£çœŸå®çš„å¤–éƒ¨æœåŠ¡
- æ‰¹é‡æ“ä½œä½¿ç”¨æ‰¹é‡æ’å…¥

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **æ•°æ®åº“è¿æ¥å¤±è´¥**: æ£€æŸ¥MongoDBæœåŠ¡æ˜¯å¦è¿è¡Œ
2. **æµ‹è¯•è¶…æ—¶**: å¢åŠ  jest.setTimeout å€¼
3. **ç¯å¢ƒå˜é‡æœªåŠ è½½**: ç¡®ä¿ .env.test æ–‡ä»¶å­˜åœ¨
4. **ç«¯å£å†²çª**: ä¿®æ”¹æµ‹è¯•ç”¨çš„ç«¯å£å·

### è°ƒè¯•æŠ€å·§
```bash
# è°ƒè¯•ç‰¹å®šæµ‹è¯•
npm run test:debug -- --testNamePattern="ç”¨æˆ·ç™»å½•"

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
NODE_ENV=test DEBUG=* npm test

# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
mongosh mall-api-test --eval "db.getCollectionNames()"
```

æœ¬æ–‡æ¡£æä¾›äº†å®Œæ•´çš„æµ‹è¯•ç¯å¢ƒè®¾ç½®ã€æ‰§è¡Œæµç¨‹å’Œæœ€ä½³å®è·µæŒ‡å—ï¼Œç¡®ä¿å•å…ƒæµ‹è¯•èƒ½å¤Ÿé¡ºåˆ©è¿è¡Œå¹¶è¦†ç›–æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## åº”ç”¨å¯åŠ¨å’Œæ•°æ®åº“è¿æ¥æµ‹è¯•ç”¨ä¾‹

### 1. åº”ç”¨å¯åŠ¨æµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: åº”ç”¨åº”è¯¥èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨å¹¶ç›‘å¬æŒ‡å®šç«¯å£
- æµ‹è¯•ç”¨ä¾‹2: åº”ç”¨å¯åŠ¨å¤±è´¥æ—¶åº”è¯¥æ­£ç¡®æŠ›å‡ºé”™è¯¯
- æµ‹è¯•ç”¨ä¾‹3: ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡®æ—¶åº”ç”¨åº”è¯¥æ­£å¸¸å¯åŠ¨

**æ–­è¨€**:
- æ–­è¨€åº”ç”¨å®ä¾‹æˆåŠŸåˆ›å»º
- æ–­è¨€ç«¯å£ç›‘å¬æ­£å¸¸
- æ–­è¨€å¯åŠ¨é”™è¯¯è¢«æ­£ç¡®æ•è·å’Œå¤„ç†

### 2. æ•°æ®åº“è¿æ¥æµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: æœ‰æ•ˆçš„MongoDBè¿æ¥å­—ç¬¦ä¸²åº”è¯¥æˆåŠŸè¿æ¥æ•°æ®åº“
- æµ‹è¯•ç”¨ä¾‹2: æ— æ•ˆçš„MongoDBè¿æ¥å­—ç¬¦ä¸²åº”è¯¥æŠ›å‡ºè¿æ¥é”™è¯¯
- æµ‹è¯•ç”¨ä¾‹3: æ•°æ®åº“è¿æ¥è¶…æ—¶åº”è¯¥æ­£ç¡®å¤„ç†
- æµ‹è¯•ç”¨ä¾‹4: æ•°æ®åº“è®¤è¯å¤±è´¥åº”è¯¥è¿”å›æ­£ç¡®çš„é”™è¯¯ä¿¡æ¯

**æ–­è¨€**:
- æ–­è¨€æ•°æ®åº“è¿æ¥æˆåŠŸæ—¶è¿”å›è¿æ¥å®ä¾‹
- æ–­è¨€è¿æ¥é”™è¯¯æ—¶æŠ›å‡ºæ­£ç¡®çš„å¼‚å¸¸
- æ–­è¨€è¿æ¥çŠ¶æ€æ­£ç¡®åæ˜ æ•°æ®åº“çŠ¶æ€

### 3. æ•°æ®åº“è¿æ¥é‡è¯•æœºåˆ¶æµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: è¿æ¥å¤±è´¥æ—¶åº”è¯¥æŒ‰ç…§é…ç½®çš„é‡è¯•æ¬¡æ•°è¿›è¡Œé‡è¯•
- æµ‹è¯•ç”¨ä¾‹2: é‡è¯•é—´éš”åº”è¯¥ç¬¦åˆé…ç½®
- æµ‹è¯•ç”¨ä¾‹3: è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°ååº”è¯¥æŠ›å‡ºæœ€ç»ˆé”™è¯¯

**æ–­è¨€**:
- æ–­è¨€é‡è¯•æœºåˆ¶æŒ‰ç…§é…ç½®æ‰§è¡Œ
- æ–­è¨€é‡è¯•é—´éš”æ­£ç¡®
- æ–­è¨€æœ€ç»ˆé”™è¯¯ä¿¡æ¯æ­£ç¡®

### 4. ç¯å¢ƒå˜é‡éªŒè¯æµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: ç¼ºå°‘å¿…è¦çš„ç¯å¢ƒå˜é‡æ—¶åº”è¯¥æŠ›å‡ºé…ç½®é”™è¯¯
- æµ‹è¯•ç”¨ä¾‹2: ç¯å¢ƒå˜é‡æ ¼å¼ä¸æ­£ç¡®æ—¶åº”è¯¥æŠ›å‡ºéªŒè¯é”™è¯¯
- æµ‹è¯•ç”¨ä¾‹3: é»˜è®¤ç¯å¢ƒå˜é‡å€¼åº”è¯¥æ­£ç¡®è®¾ç½®

**æ–­è¨€**:
- æ–­è¨€ç¯å¢ƒå˜é‡éªŒè¯æ­£ç¡®
- æ–­è¨€é…ç½®é”™è¯¯ä¿¡æ¯æ˜ç¡®
- æ–­è¨€é»˜è®¤å€¼è®¾ç½®æ­£ç¡®

## é…ç½®æ•°æ®æ ¼å¼

### åº”ç”¨é…ç½®
```typescript
// åº”ç”¨å¯åŠ¨é…ç½®
const appConfig = {
  port: 3000,
  host: 'localhost',
  env: 'development',
  cors: {
    origin: ['http://localhost:3000'],
    credentials: true
  }
};

// æ•°æ®åº“è¿æ¥é…ç½®  
const dbConfig = {
  uri: 'mongodb://localhost:27017/mall-api-test',
  options: {
    useNewUrlParser: true,
    useUnifiedTopology: true,
    connectTimeoutMS: 10000,
    socketTimeoutMS: 45000,
    maxPoolSize: 10,
    minPoolSize: 1,
    retryWrites: true,
    w: 'majority'
  },
  retry: {
    attempts: 3,
    delay: 1000
  }
};

// ç¯å¢ƒå˜é‡è¦æ±‚
const requiredEnvVars = [
  'DATABASE_URL',
  'JWT_SECRET', 
  'NODE_ENV'
];
```

### æµ‹è¯•æ•°æ®å‡†å¤‡
```typescript
// æ•°æ®åº“è¿æ¥æµ‹è¯•æ•°æ®
const testDbConnection = {
  validUri: 'mongodb://localhost:27017/test-db',
  invalidUri: 'mongodb://invalid-host:27017/test-db',
  timeoutUri: 'mongodb://slow-host:27017/test-db?connectTimeoutMS=100'
};

// åº”ç”¨å¯åŠ¨æµ‹è¯•æ•°æ®
const testAppConfig = {
  validPort: 3000,
  invalidPort: 99999,
  validHost: 'localhost',
  invalidHost: '256.256.256.256'
};
```

### é”™è¯¯å¤„ç†æµ‹è¯•
```typescript
// é¢„æœŸçš„é”™è¯¯æ¶ˆæ¯
const expectedErrors = {
  dbConnection: 'æ•°æ®åº“è¿æ¥å¤±è´¥',
  dbTimeout: 'æ•°æ®åº“è¿æ¥è¶…æ—¶',
  dbAuth: 'æ•°æ®åº“è®¤è¯å¤±è´¥',
  appStart: 'åº”ç”¨å¯åŠ¨å¤±è´¥',
  envMissing: 'ç¼ºå°‘å¿…è¦çš„ç¯å¢ƒå˜é‡'
};
```

## è®¤è¯æ¨¡å—æµ‹è¯•ç”¨ä¾‹

### 1. ç”¨æˆ·ç™»å½•æ¥å£æµ‹è¯•

**æ¥å£**: POST /auth/login

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç åº”è¯¥è¿”å›æˆåŠŸçŠ¶æ€ï¼ˆcode: 200ï¼‰å’Œè®¿é—®ä»¤ç‰Œ
- æµ‹è¯•ç”¨ä¾‹2: é”™è¯¯çš„ç”¨æˆ·ååº”è¯¥è¿”å›è®¤è¯é”™è¯¯ï¼ˆcode: 2011ï¼‰
- æµ‹è¯•ç”¨ä¾‹3: é”™è¯¯çš„å¯†ç åº”è¯¥è¿”å›è®¤è¯é”™è¯¯ï¼ˆcode: 2011ï¼‰
- æµ‹è¯•ç”¨ä¾‹4: ç¦ç”¨çš„ç”¨æˆ·è´¦æˆ·åº”è¯¥è¿”å›è´¦æˆ·ç¦ç”¨é”™è¯¯ï¼ˆcode: 2005ï¼‰

**è¯·æ±‚æ•°æ®æ ¼å¼**:
```json
{
  "username": "string",
  "password": "string"
}
```

**å“åº”æ•°æ®æ ¼å¼**:
```json
{
  "access_token": "string",
}
```

**æ–­è¨€**:
- æ–­è¨€ç™»å½•æˆåŠŸæ—¶è¿”å›çš„å“åº”åŒ…å«access_token
- æ–­è¨€ç™»å½•å¤±è´¥æ—¶è¿”å›æ­£ç¡®çš„é”™è¯¯ç å’Œé”™è¯¯ä¿¡æ¯

### 2. è·å–ç”¨æˆ·èµ„æ–™æ¥å£æµ‹è¯•

**æ¥å£**: GET /auth/profile

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: æœ‰æ•ˆçš„JWTä»¤ç‰Œåº”è¯¥è¿”å›æˆåŠŸçŠ¶æ€ï¼ˆcode: 200ï¼‰å’Œç”¨æˆ·ä¿¡æ¯
- æµ‹è¯•ç”¨ä¾‹2: æ— æ•ˆçš„JWTä»¤ç‰Œåº”è¯¥è¿”å›è®¤è¯ä»¤ç‰Œæ— æ•ˆé”™è¯¯ï¼ˆcode: 2001ï¼‰
- æµ‹è¯•ç”¨ä¾‹3: è¿‡æœŸçš„JWTä»¤ç‰Œåº”è¯¥è¿”å›è®¤è¯ä»¤ç‰Œæ— æ•ˆé”™è¯¯ï¼ˆcode: 2001ï¼‰

**è¯·æ±‚æ•°æ®æ ¼å¼**: éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­åŒ…å«æœ‰æ•ˆçš„JWTä»¤ç‰Œ

**å“åº”æ•°æ®æ ¼å¼**:
```json
{
  "id": "string",
  "username": "string",
  "email": "string",
  "phone": "string",
  "role": "string",
  "status": "string",
  "createdAt": "string",
  "updatedAt": "string"
}
```

**æ–­è¨€**:
- æ–­è¨€æˆåŠŸè·å–ç”¨æˆ·èµ„æ–™æ—¶è¿”å›å®Œæ•´çš„ç”¨æˆ·ä¿¡æ¯
- æ–­è¨€è®¤è¯å¤±è´¥æ—¶è¿”å›æ­£ç¡®çš„é”™è¯¯ä¿¡æ¯

### 3. ä¿®æ”¹å¯†ç æ¥å£æµ‹è¯•

**æ¥å£**: POST /auth/password

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: æ­£ç¡®çš„å½“å‰å¯†ç å’Œæ–°å¯†ç åº”è¯¥è¿”å›æˆåŠŸçŠ¶æ€ï¼ˆcode: 200ï¼‰
- æµ‹è¯•ç”¨ä¾‹2: é”™è¯¯çš„å½“å‰å¯†ç åº”è¯¥è¿”å›å¯†ç ä¸åŒ¹é…é”™è¯¯ï¼ˆcode: 2013ï¼‰
- æµ‹è¯•ç”¨ä¾‹3: æ–°å¯†ç å’Œç¡®è®¤å¯†ç ä¸åŒ¹é…åº”è¯¥è¿”å›éªŒè¯å¤±è´¥é”™è¯¯ï¼ˆcode: 9007ï¼‰
- æµ‹è¯•ç”¨ä¾‹4: æ–°å¯†ç ä¸å½“å‰å¯†ç ç›¸åŒåº”è¯¥è¿”å›å¯†ç ç›¸åŒé”™è¯¯ï¼ˆcode: 3014ï¼‰

**è¯·æ±‚æ•°æ®æ ¼å¼**:
```json
{
  "currentPassword": "string",
  "newPassword": "string",
  "confirmPassword": "string"
}
```

**å“åº”æ•°æ®æ ¼å¼**:
```json
{
  "message": "string"
}
```

**æ–­è¨€**:
- æ–­è¨€å¯†ç ä¿®æ”¹æˆåŠŸæ—¶è¿”å›æˆåŠŸæ¶ˆæ¯
- æ–­è¨€å„ç§é”™è¯¯æƒ…å†µè¿”å›æ­£ç¡®çš„é”™è¯¯ç 

## ç”¨æˆ·ç®¡ç†æ¨¡å—æµ‹è¯•ç”¨ä¾‹

### 1. è·å–ç”¨æˆ·åˆ—è¡¨æ¥å£æµ‹è¯•

**æ¥å£**: GET /users/list

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: æœ‰æƒé™çš„ç”¨æˆ·åº”è¯¥è¿”å›æˆåŠŸçŠ¶æ€ï¼ˆcode: 200ï¼‰å’Œç”¨æˆ·åˆ—è¡¨
- æµ‹è¯•ç”¨ä¾‹2: æ— æƒé™çš„ç”¨æˆ·åº”è¯¥è¿”å›æƒé™ä¸è¶³é”™è¯¯ï¼ˆcode: 4006ï¼‰
- æµ‹è¯•ç”¨ä¾‹3: åˆ†é¡µå‚æ•°æµ‹è¯•åº”è¯¥è¿”å›æ­£ç¡®çš„åˆ†é¡µç»“æœ

**è¯·æ±‚æ•°æ®æ ¼å¼**: å¯é€‰çš„æŸ¥è¯¢å‚æ•°
```json
{
  "page": "number",
  "limit": "number",
  "search": "string"
}
```

**å“åº”æ•°æ®æ ¼å¼**:
```json
{
  "data": [
    {
      "id": "string",
      "username": "string",
      "email": "string",
      "phone": "string",
      "role": "string",
      "status": "string",
      "createdAt": "string"
    }
  ],
  "total": "number",
  "page": "number",
  "limit": "number"
}
```

**æ–­è¨€**:
- æ–­è¨€è¿”å›çš„ç”¨æˆ·åˆ—è¡¨åŒ…å«æ­£ç¡®çš„å­—æ®µ
- æ–­è¨€åˆ†é¡µä¿¡æ¯æ­£ç¡®

### 2. åˆ›å»ºç”¨æˆ·æ¥å£æµ‹è¯•

**æ¥å£**: POST /users/create

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: æœ‰æ•ˆçš„ç”¨æˆ·æ•°æ®åº”è¯¥è¿”å›æˆåŠŸçŠ¶æ€ï¼ˆcode: 200ï¼‰
- æµ‹è¯•ç”¨ä¾‹2: é‡å¤çš„ç”¨æˆ·ååº”è¯¥è¿”å›ç”¨æˆ·å·²å­˜åœ¨é”™è¯¯ï¼ˆcode: 3001ï¼‰
- æµ‹è¯•ç”¨ä¾‹3: é‡å¤çš„é‚®ç®±åº”è¯¥è¿”å›ç”¨æˆ·å·²å­˜åœ¨é”™è¯¯ï¼ˆcode: 3001ï¼‰
- æµ‹è¯•ç”¨ä¾‹4: æ— æ•ˆçš„ç”¨æˆ·æ•°æ®åº”è¯¥è¿”å›éªŒè¯å¤±è´¥é”™è¯¯ï¼ˆcode: 9007ï¼‰

**è¯·æ±‚æ•°æ®æ ¼å¼**:
```json
{
  "username": "string",
  "password": "string",
  "email": "string",
  "phone": "string",
  "role": "string"
}
```

**å“åº”æ•°æ®æ ¼å¼**:
```json
{
  "id": "string",
  "username": "string",
  "email": "string",
  "phone": "string",
  "role": "string",
  "createdAt": "string"
}
```

**æ–­è¨€**:
- æ–­è¨€åˆ›å»ºæˆåŠŸæ—¶è¿”å›åˆ›å»ºçš„ç”¨æˆ·ä¿¡æ¯
- æ–­è¨€é‡å¤æ•°æ®æ—¶è¿”å›æ­£ç¡®çš„é”™è¯¯ä¿¡æ¯

### 3. æ›´æ–°ç”¨æˆ·æ¥å£æµ‹è¯•

**æ¥å£**: POST /users/update

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: æœ‰æ•ˆçš„æ›´æ–°æ•°æ®åº”è¯¥è¿”å›æˆåŠŸçŠ¶æ€ï¼ˆcode: 200ï¼‰
- æµ‹è¯•ç”¨ä¾‹2: æ›´æ–°ä¸å­˜åœ¨çš„ç”¨æˆ·åº”è¯¥è¿”å›ç”¨æˆ·ä¸å­˜åœ¨é”™è¯¯ï¼ˆcode: 3000ï¼‰
- æµ‹è¯•ç”¨ä¾‹3: ç”¨æˆ·ä¸èƒ½ä¿®æ”¹è‡ªå·±çš„è§’è‰²å’ŒçŠ¶æ€

**è¯·æ±‚æ•°æ®æ ¼å¼**:
```json
{
  "id": "string",
  "username": "string",
  "email": "string", 
  "phone": "string",
  "role": "string",
  "status": "string"
}
```

**å“åº”æ•°æ®æ ¼å¼**:
```json
{
  "id": "string",
  "username": "string",
  "email": "string",
  "phone": "string",
  "role": "string",
  "status": "string",
  "updatedAt": "string"
}
```

**æ–­è¨€**:
- æ–­è¨€æ›´æ–°æˆåŠŸæ—¶è¿”å›æ›´æ–°åçš„ç”¨æˆ·ä¿¡æ¯
- æ–­è¨€æƒé™æ§åˆ¶æ­£ç¡®

### 4. åˆ é™¤ç”¨æˆ·æ¥å£æµ‹è¯•

**æ¥å£**: POST /users/delete

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: åˆ é™¤å­˜åœ¨çš„ç”¨æˆ·åº”è¯¥è¿”å›æˆåŠŸçŠ¶æ€ï¼ˆcode: 200ï¼‰
- æµ‹è¯•ç”¨ä¾‹2: åˆ é™¤ä¸å­˜åœ¨çš„ç”¨æˆ·åº”è¯¥è¿”å›ç”¨æˆ·ä¸å­˜åœ¨é”™è¯¯ï¼ˆcode: 3000ï¼‰
- æµ‹è¯•ç”¨ä¾‹3: ç”¨æˆ·ä¸èƒ½åˆ é™¤è‡ªå·±åº”è¯¥è¿”å›æƒé™ä¸è¶³é”™è¯¯ï¼ˆcode: 4006ï¼‰

**è¯·æ±‚æ•°æ®æ ¼å¼**:
```json
{
  "id": "string"
}
```

**å“åº”æ•°æ®æ ¼å¼**:
```json
{
  "message": "string"
}
```

**æ–­è¨€**:
- æ–­è¨€åˆ é™¤æˆåŠŸæ—¶è¿”å›æˆåŠŸæ¶ˆæ¯
- æ–­è¨€æƒé™æ§åˆ¶æ­£ç¡®

## è§’è‰²ç®¡ç†æ¨¡å—æµ‹è¯•ç”¨ä¾‹

### 1. åˆ›å»ºè§’è‰²æ¥å£æµ‹è¯•

**æ¥å£**: POST /roles/create

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: æœ‰æ•ˆçš„è§’è‰²æ•°æ®åº”è¯¥è¿”å›æˆåŠŸçŠ¶æ€ï¼ˆcode: 200ï¼‰
- æµ‹è¯•ç”¨ä¾‹2: é‡å¤çš„è§’è‰²åç§°åº”è¯¥è¿”å›è§’è‰²å·²å­˜åœ¨é”™è¯¯ï¼ˆéœ€è¦æ ¹æ®å®é™…æƒ…å†µå®šä¹‰é”™è¯¯ç ï¼‰
- æµ‹è¯•ç”¨ä¾‹3: æ— æ•ˆçš„è§’è‰²æ•°æ®åº”è¯¥è¿”å›éªŒè¯å¤±è´¥é”™è¯¯ï¼ˆcode: 9007ï¼‰

**è¯·æ±‚æ•°æ®æ ¼å¼**:
```json
{
  "name": "string",
  "code": "string",
  "type": "string",
  "description": "string"
}
```

**å“åº”æ•°æ®æ ¼å¼**:
```json
{
  "id": "string",
  "name": "string",
  "code": "string",
  "type": "string",
  "description": "string",
  "createdAt": "string"
}
```

**æ–­è¨€**:
- æ–­è¨€åˆ›å»ºæˆåŠŸæ—¶è¿”å›åˆ›å»ºçš„è§’è‰²ä¿¡æ¯
- æ–­è¨€è§’è‰²ç±»å‹ä¸€æ—¦åˆ›å»ºåä¸å¯ä¿®æ”¹

### 2. è·å–è§’è‰²åˆ—è¡¨æ¥å£æµ‹è¯•

**æ¥å£**: GET /roles/list

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: æœ‰æƒé™çš„ç”¨æˆ·åº”è¯¥è¿”å›æˆåŠŸçŠ¶æ€ï¼ˆcode: 200ï¼‰å’Œè§’è‰²åˆ—è¡¨
- æµ‹è¯•ç”¨ä¾‹2: æ— æƒé™çš„ç”¨æˆ·åº”è¯¥è¿”å›æƒé™ä¸è¶³é”™è¯¯ï¼ˆcode: 4006ï¼‰

**è¯·æ±‚æ•°æ®æ ¼å¼**: æ— è¯·æ±‚ä½“ï¼Œå¯é€‰æŸ¥è¯¢å‚æ•°

**å“åº”æ•°æ®æ ¼å¼**:
```json
{
  "data": [
    {
      "id": "string",
      "name": "string",
      "code": "string",
      "type": "string",
      "description": "string",
      "createdAt": "string"
    }
  ]
}
```

**æ–­è¨€**:
- æ–­è¨€è¿”å›çš„è§’è‰²åˆ—è¡¨åŒ…å«æ‰€æœ‰ç³»ç»Ÿè§’è‰²
- æ–­è¨€æƒé™æ§åˆ¶æ­£ç¡®

### 3. æ›´æ–°è§’è‰²æƒé™æ¥å£æµ‹è¯•

**æ¥å£**: POST /roles/update-permissions

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: æœ‰æ•ˆçš„æƒé™æ›´æ–°åº”è¯¥è¿”å›æˆåŠŸçŠ¶æ€ï¼ˆcode: 200ï¼‰
- æµ‹è¯•ç”¨ä¾‹2: æ›´æ–°ä¸å­˜åœ¨çš„è§’è‰²åº”è¯¥è¿”å›è§’è‰²ä¸å­˜åœ¨é”™è¯¯ï¼ˆcode: 5000ï¼‰
- æµ‹è¯•ç”¨ä¾‹3: æ— æ•ˆçš„æƒé™IDåº”è¯¥è¿”å›éªŒè¯å¤±è´¥é”™è¯¯ï¼ˆcode: 9007ï¼‰

**è¯·æ±‚æ•°æ®æ ¼å¼**:
```json
{
  "roleId": "string",
  "permissionIds": ["string"]
}
```

**å“åº”æ•°æ®æ ¼å¼**:
```json
{
  "id": "string",
  "name": "string",
  "permissions": [
    {
      "id": "string",
      "name": "string",
      "code": "string"
    }
  ]
}
```

**æ–­è¨€**:
- æ–­è¨€æƒé™æ›´æ–°æˆåŠŸæ—¶è¿”å›æ›´æ–°åçš„è§’è‰²ä¿¡æ¯
- æ–­è¨€æƒé™æ§åˆ¶æ­£ç¡®

## æƒé™ç®¡ç†æ¨¡å—æµ‹è¯•ç”¨ä¾‹

### 1. åˆ›å»ºæƒé™æ¥å£æµ‹è¯•

**æ¥å£**: POST /permissions/create

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: æœ‰æ•ˆçš„æƒé™æ•°æ®åº”è¯¥è¿”å›æˆåŠŸçŠ¶æ€ï¼ˆcode: 200ï¼‰
- æµ‹è¯•ç”¨ä¾‹2: é‡å¤çš„æƒé™ä»£ç åº”è¯¥è¿”å›æƒé™å·²å­˜åœ¨é”™è¯¯ï¼ˆcode: 4007ï¼‰
- æµ‹è¯•ç”¨ä¾‹3: æ— æ•ˆçš„æƒé™æ•°æ®åº”è¯¥è¿”å›éªŒè¯å¤±è´¥é”™è¯¯ï¼ˆcode: 9007ï¼‰

**è¯·æ±‚æ•°æ®æ ¼å¼**:
```json
{
  "name": "string",
  "code": "string",
  "type": "string",
  "description": "string"
}
```

**å“åº”æ•°æ®æ ¼å¼**:
```json
{
  "id": "string",
  "name": "string",
  "code": "string",
  "type": "string",
  "description": "string",
  "createdAt": "string"
}
```

**æ–­è¨€**:
- æ–­è¨€åˆ›å»ºæˆåŠŸæ—¶è¿”å›åˆ›å»ºçš„æƒé™ä¿¡æ¯
- æ–­è¨€æƒé™ä»£ç å”¯ä¸€æ€§éªŒè¯æ­£ç¡®

### 2. è·å–æƒé™åˆ—è¡¨æ¥å£æµ‹è¯•

**æ¥å£**: GET /permissions/list

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: æœ‰æƒé™çš„ç”¨æˆ·åº”è¯¥è¿”å›æˆåŠŸçŠ¶æ€ï¼ˆcode: 200ï¼‰å’Œæƒé™åˆ—è¡¨
- æµ‹è¯•ç”¨ä¾‹2: æŒ‰ç±»å‹ç­›é€‰æƒé™åº”è¯¥è¿”å›æ­£ç¡®çš„ç»“æœ

**è¯·æ±‚æ•°æ®æ ¼å¼**: å¯é€‰æŸ¥è¯¢å‚æ•° type="string"

**å“åº”æ•°æ®æ ¼å¼**:
```json
{
  "data": [
    {
      "id": "string",
      "name": "string",
      "code": "string",
      "type": "string",
      "description": "string"
    }
  ]
}
```

**æ–­è¨€**:
- æ–­è¨€è¿”å›çš„æƒé™åˆ—è¡¨åŒ…å«æ‰€æœ‰æƒé™ç±»å‹
- æ–­è¨€ç­›é€‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

## èœå•ç®¡ç†æ¨¡å—æµ‹è¯•ç”¨ä¾‹

### 1. è·å–èœå•åˆ—è¡¨æ¥å£æµ‹è¯•

**æ¥å£**: GET /menus

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: ä¸åŒè§’è‰²çš„ç”¨æˆ·åº”è¯¥è¿”å›ä¸åŒçš„èœå•åˆ—è¡¨
- æµ‹è¯•ç”¨ä¾‹2: ç®¡ç†å‘˜è§’è‰²åº”è¯¥è¿”å›æ‰€æœ‰èœå•

**è¯·æ±‚æ•°æ®æ ¼å¼**: éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­åŒ…å«æœ‰æ•ˆçš„JWTä»¤ç‰Œ

**å“åº”æ•°æ®æ ¼å¼**:
```json
[
  {
    "id": "string",
    "name": "string",
    "path": "string",
    "icon": "string",
    "children": [
      {
        "id": "string",
        "name": "string",
        "path": "string",
        "icon": "string"
      }
    ]
  }
]
```

**æ–­è¨€**:
- æ–­è¨€èœå•åˆ—è¡¨æ ¹æ®è§’è‰²æƒé™æ­£ç¡®è¿‡æ»¤
- æ–­è¨€èœå•å±‚çº§ç»“æ„æ­£ç¡®

### 2. åˆ›å»ºèœå•æ¥å£æµ‹è¯•

**æ¥å£**: POST /menus/create

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: æœ‰æ•ˆçš„èœå•æ•°æ®åº”è¯¥è¿”å›æˆåŠŸçŠ¶æ€ï¼ˆcode: 200ï¼‰
- æµ‹è¯•ç”¨ä¾‹2: é‡å¤çš„èœå•è·¯å¾„åº”è¯¥è¿”å›èœå•å·²å­˜åœ¨é”™è¯¯ï¼ˆcode: 7001ï¼‰
- æµ‹è¯•ç”¨ä¾‹3: æ— æ•ˆçš„çˆ¶èœå•IDåº”è¯¥è¿”å›éªŒè¯å¤±è´¥é”™è¯¯ï¼ˆcode: 9007ï¼‰

**è¯·æ±‚æ•°æ®æ ¼å¼**:
```json
{
  "name": "string",
  "path": "string",
  "icon": "string",
  "parentId": "string",
  "order": "number"
}
```

**å“åº”æ•°æ®æ ¼å¼**:
```json
{
  "id": "string",
  "name": "string",
  "path": "string",
  "icon": "string",
  "parentId": "string",
  "order": "number",
  "createdAt": "string"
}
```

**æ–­è¨€**:
- æ–­è¨€åˆ›å»ºæˆåŠŸæ—¶è¿”å›åˆ›å»ºçš„èœå•ä¿¡æ¯
- æ–­è¨€èœå•å±‚çº§éªŒè¯æ­£ç¡®

## ææ–™ç®¡ç†æ¨¡å—æµ‹è¯•ç”¨ä¾‹

### 1. è·å–ææ–™åˆ—è¡¨æ¥å£æµ‹è¯•

**æ¥å£**: POST /material/list

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: æœ‰æ•ˆçš„æŸ¥è¯¢å‚æ•°åº”è¯¥è¿”å›code: 200å’Œææ–™åˆ—è¡¨
- æµ‹è¯•ç”¨ä¾‹2: åˆ†é¡µæŸ¥è¯¢åº”è¯¥è¿”å›æ­£ç¡®çš„åˆ†é¡µç»“æœ
- æµ‹è¯•ç”¨ä¾‹3: æŒ‰åˆ†ç±»ç­›é€‰åº”è¯¥è¿”å›æ­£ç¡®çš„ç»“æœ

**è¯·æ±‚æ•°æ®æ ¼å¼**:
```json
{
  "page": "number",
  "limit": "number",
  "categoryId": "string",
  "search": "string",
  "status": "string"
}
```

**å“åº”æ•°æ®æ ¼å¼**:
```json
{
  "data": [
    {
      "id": "string",
      "materialId": "string",
      "name": "string",
      "categoryId": "string",
      "categoryName": "string",
      "status": "string",
      "createdAt": "string"
    }
  ],
  "total": "number",
  "page": "number",
  "limit": "number"
}
```

**æ–­è¨€**:
- æ–­è¨€è¿”å›çš„ææ–™åˆ—è¡¨åŒ…å«æ­£ç¡®çš„å­—æ®µ
- æ–­è¨€åˆ†é¡µå’Œç­›é€‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

### 2. åˆ›å»ºææ–™æ¥å£æµ‹è¯•

**æ¥å£**: POST /material/create

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: æœ‰æ•ˆçš„ææ–™æ•°æ®åº”è¯¥è¿”å›code: 200
- æµ‹è¯•ç”¨ä¾‹2: é‡å¤çš„ææ–™IDåº”è¯¥è¿”å›code: 1001ï¼ˆé‡å¤æ•°æ®é”™è¯¯ç ï¼‰
- æµ‹è¯•ç”¨ä¾‹3: æ— æ•ˆçš„åˆ†ç±»IDåº”è¯¥è¿”å›code: 1002ï¼ˆæ•°æ®éªŒè¯é”™è¯¯ç ï¼‰

**è¯·æ±‚æ•°æ®æ ¼å¼**:
```json
{
  "materialId": "string",
  "name": "string",
  "categoryId": "string",
  "description": "string",
  "unit": "string",
  "price": "number",
  "stock": "number"
}
```

**å“åº”æ•°æ®æ ¼å¼**:
```json
{
  "id": "string"
}
```

**æ–­è¨€**:
- æ–­è¨€åˆ›å»ºæˆåŠŸæ—¶è¿”å›ææ–™ID
- æ–­è¨€æ•°æ®éªŒè¯æ­£ç¡®

### 3. æ›´æ–°ææ–™æ¥å£æµ‹è¯•

**æ¥å£**: POST /material/update

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: æœ‰æ•ˆçš„æ›´æ–°æ•°æ®åº”è¯¥è¿”å›code: 200
- æµ‹è¯•ç”¨ä¾‹2: æ›´æ–°ä¸å­˜åœ¨çš„ææ–™åº”è¯¥è¿”å›code: 1003ï¼ˆæ•°æ®ä¸å­˜åœ¨é”™è¯¯ç ï¼‰
- æµ‹è¯•ç”¨ä¾‹3: å¹¶å‘æ›´æ–°åº”è¯¥æ­£ç¡®å¤„ç†

**è¯·æ±‚æ•°æ®æ ¼å¼**:
```json
{
  "id": "string",
  "materialId": "string",
  "name": "string",
  "categoryId": "string",
  "description": "string",
  "unit": "string",
  "price": "number",
  "stock": "number",
  "status": "string"
}
```

**å“åº”æ•°æ®æ ¼å¼**: ç©ºå“åº”ä½“æˆ–æˆåŠŸæ¶ˆæ¯

**æ–­è¨€**:
- æ–­è¨€æ›´æ–°æˆåŠŸæ—¶ä¸è¿”å›æ•°æ®
- æ–­è¨€é”™è¯¯å¤„ç†æ­£ç¡®

## åˆ†ç±»ç®¡ç†æ¨¡å—æµ‹è¯•ç”¨ä¾‹

### 1. è·å–åˆ†ç±»æ ‘æ¥å£æµ‹è¯•

**æ¥å£**: GET /category/tree

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: åº”è¯¥è¿”å›æˆåŠŸçŠ¶æ€ï¼ˆcode: 200ï¼‰å’Œå®Œæ•´çš„åˆ†ç±»æ ‘ç»“æ„
- æµ‹è¯•ç”¨ä¾‹2: åˆ†ç±»æ ‘åº”è¯¥åŒ…å«æ­£ç¡®çš„å±‚çº§å…³ç³»

**è¯·æ±‚æ•°æ®æ ¼å¼**: æ— è¯·æ±‚ä½“

**å“åº”æ•°æ®æ ¼å¼**:
```json
[
  {
    "id": "string",
    "name": "string",
    "code": "string",
    "children": [
      {
        "id": "string",
        "name": "string",
        "code": "string"
      }
    ]
  }
]
```

**æ–­è¨€**:
- æ–­è¨€è¿”å›çš„åˆ†ç±»æ ‘ç»“æ„æ­£ç¡®
- æ–­è¨€çˆ¶å­å…³ç³»æ­£ç¡®ç»´æŠ¤

### 2. åˆ›å»ºåˆ†ç±»æ¥å£æµ‹è¯•

**æ¥å£**: POST /category/create

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: æœ‰æ•ˆçš„åˆ†ç±»æ•°æ®åº”è¯¥è¿”å›æˆåŠŸçŠ¶æ€ï¼ˆcode: 200ï¼‰
- æµ‹è¯•ç”¨ä¾‹2: é‡å¤çš„åˆ†ç±»åç§°åº”è¯¥è¿”å›åˆ†ç±»å·²å­˜åœ¨é”™è¯¯ï¼ˆcode: 8001ï¼‰
- æµ‹è¯•ç”¨ä¾‹3: æ— æ•ˆçš„çˆ¶åˆ†ç±»IDåº”è¯¥è¿”å›éªŒè¯å¤±è´¥é”™è¯¯ï¼ˆcode: 9007ï¼‰

**è¯·æ±‚æ•°æ®æ ¼å¼**:
```json
{
  "name": "string",
  "code": "string",
  "parentId": "string",
  "description": "string"
}
```

**å“åº”æ•°æ®æ ¼å¼**:
```json
{
  "id": "string"
}
```

**æ–­è¨€**:
- æ–­è¨€åˆ›å»ºæˆåŠŸæ—¶è¿”å›åˆ†ç±»ID
- æ–­è¨€åˆ†ç±»å±‚çº§éªŒè¯æ­£ç¡®

### 3. ç§»åŠ¨åˆ†ç±»æ¥å£æµ‹è¯•

**æ¥å£**: POST /category/move

**æµ‹è¯•åœºæ™¯**:
- æµ‹è¯•ç”¨ä¾‹1: æœ‰æ•ˆçš„ç§»åŠ¨æ“ä½œåº”è¯¥è¿”å›æˆåŠŸçŠ¶æ€ï¼ˆcode: 200ï¼‰
- æµ‹è¯•ç”¨ä¾‹2: ç§»åŠ¨åˆ°è‡ªå·±çš„å­åˆ†ç±»åº”è¯¥è¿”å›åˆ†ç±»ä¸èƒ½ç§»åŠ¨åˆ°è‡ªèº«é”™è¯¯ï¼ˆcode: 8007ï¼‰
- æµ‹è¯•ç”¨ä¾‹3: ç§»åŠ¨ååˆ†ç±»æ ‘ç»“æ„åº”è¯¥æ­£ç¡®æ›´æ–°

**è¯·æ±‚æ•°æ®æ ¼å¼**:
```json
{
  "categoryId": "string",
  "newParentId": "string"
}
```

**å“åº”æ•°æ®æ ¼å¼**: ç©ºå“åº”ä½“æˆ–æˆåŠŸæ¶ˆæ¯

**æ–­è¨€**:
- æ–­è¨€ç§»åŠ¨æ“ä½œæˆåŠŸ
- æ–­è¨€åˆ†ç±»æ ‘ç»“æ„æ­£ç¡®ç»´æŠ¤

## æµ‹è¯•æ•°æ®å‡†å¤‡

### é€šç”¨æµ‹è¯•æ•°æ®
```typescript
// æµ‹è¯•ç”¨æˆ·æ•°æ®
const testUser = {
  username: 'testuser',
  password: 'Test123!',
  email: 'test@example.com',
  phone: '13800138000'
};

// æµ‹è¯•è§’è‰²æ•°æ®
const testRole = {
  name: 'æµ‹è¯•è§’è‰²',
  code: 'TEST_ROLE',
  type: 'CUSTOM'
};

// æµ‹è¯•æƒé™æ•°æ®  
const testPermission = {
  name: 'æµ‹è¯•æƒé™',
  code: 'TEST_PERMISSION',
  type: 'API'
};

// æµ‹è¯•ææ–™æ•°æ®
const testMaterial = {
  materialId: 'TEST001',
  name: 'æµ‹è¯•ææ–™',
  categoryId: 'valid-category-id'
};

// æµ‹è¯•åˆ†ç±»æ•°æ®
const testCategory = {
  name: 'æµ‹è¯•åˆ†ç±»',
  code: 'TEST_CATEGORY'
};

// æµ‹è¯•èœå•æ•°æ®
const testMenu = {
  name: 'æµ‹è¯•èœå•',
  path: '/test-menu',
  icon: 'test-icon',
  parentId: null,
  order: 1
};

const testSubMenu = {
  name: 'æµ‹è¯•å­èœå•', 
  path: '/test-menu/sub',
  icon: 'sub-icon',
  parentId: 'valid-parent-menu-id',
  order: 1
};
```

### æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
æ¯ä¸ªæµ‹è¯•å¥—ä»¶è¿è¡Œå‰åº”è¯¥:
1. æ¸…ç©ºç›¸å…³é›†åˆ
2. æ’å…¥åŸºç¡€æµ‹è¯•æ•°æ®
3. è®¾ç½®æµ‹è¯•ç¯å¢ƒ

## æµ‹è¯•æ‰§è¡Œå‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
npm test -- --testNamePattern="è®¤è¯æ¨¡å—"

# ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
npm run test:cov

# ç›‘è§†æ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test:watch
```

## æ³¨æ„äº‹é¡¹

1. æ‰€æœ‰æµ‹è¯•åº”è¯¥ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®åº“
2. æµ‹è¯•å®Œæˆååº”è¯¥æ¸…ç†æµ‹è¯•æ•°æ®
3. æ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ–ï¼ˆå¦‚é‚®ä»¶æœåŠ¡ã€çŸ­ä¿¡æœåŠ¡ï¼‰
4. ä½¿ç”¨é€‚å½“çš„æµ‹è¯•éš”ç¦»ç­–ç•¥
5. æ–­è¨€æ¶ˆæ¯ä½¿ç”¨ä¸­æ–‡æè¿°